---
theme: apple-basic
layout: intro-image
image: 'https://i.pinimg.com/564x/35/5d/d8/355dd88362d2b72ff4f84b3041b516a4.jpg'
fonts:
  sans: M PLUS 1p
---

<div class="absolute top-10">
  <span class="font-700">
    2022/5/18 ã™ã•
  </span>
</div>

<div class="absolute bottom-10">
  <h1>æ˜æ—¥ã‹ã‚‰å°å…¥ã§ãã‚‹<br>Flutter CI å…¥é–€</h1>
  <p>GitHub Actions ã§ CI ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å¾¹åº•è§£èª¬</p>
</div>

---
layout: statement
---

# ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«

<br>

CI ã®å¿…è¦æ€§ã‚’ç†è§£ã—ã¦æ˜æ—¥å°å…¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹

<style>
p {
  font-size: 30px;
}
</style>

---

# ã‚‚ãã˜

<div grid="~ cols-2 gap-4">
<div>

- ã¯ã˜ã‚ã«

- CI
  - CI ã¨ã¯ä½•ã‹ï¼Ÿ
  - CI å°å…¥ã®ãƒ¡ãƒªãƒƒãƒˆã¨ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
  - CI ã®å°å…¥æ–¹æ³•

- GitHub Actions
  - GitHub Actions ã¨ã¯
  - YAML ã¨ã¯
  - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ§‹æˆã¨å®šç¾©æ–¹æ³•
  - å®Ÿä¾‹

</div>
<div>

- Tips

- ã‚³ãƒ©ãƒ 

</div>
</div>

<div class="absolute bottom-10 right-5">
  <p>ç™ºè¡¨æ™‚é–“ 50 åˆ†ï¼ˆè³ªç–‘ 10 åˆ†ï¼‰</p>
</div>

---

# è‡ªå·±ç´¹ä»‹

<img src="https://pbs.twimg.com/profile_images/3229257541/0f3a5a42716a230e07619abc86d67b8d_400x400.png" class="rounded shadow absolute  top-10 right-10" width="160" >

- ã™ã•

  - Twitter: [@susatthi](https://twitter.com/susatthi)
  - GitHub: [@susatthi](https://github.com/susatthi)

éƒ½å†…åœ¨ä½ ï¼’å…ã®ãƒ‘ãƒ‘å…¼ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼ˆï¼•å¹´ç›®ï¼‰ã€è‡ªå‹•åŒ–å¤§å¥½ããƒãƒ³<br>
Flutter å¤§å­¦ã¯ 2020å¹´7æœˆã€œã€ Flutter æ­´ã¯ç´„ 2 å¹´<br>
ä»•äº‹ã§ã¯ Swift / PHPã€Flutter ã¯å€‹äººé–‹ç™ºã§ä½¿ç”¨<br>
å€‹äººã‚¢ãƒ—ãƒªã€ŒåŒ»ç™‚è²»ã‚’ç®¡ç†ã—ã¦è³¢ãç¯€ç¨ã€ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¦ã„ã¾ã™ï¼

<img src="/images/medical-deduction.png" class="rounded shadow absolute" width="340" >

---

# ã¯ã˜ã‚ã«

<br>

ã‚ãªãŸã¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã® Flutter ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚

ã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¦åŠå¹´ãŒçµŒã¡ãƒ¦ãƒ¼ã‚¶æ•°ã‚‚ä¼¸ã³ã¦ããŸã¨ã“ã‚ã§æ¬¡ã®èª²é¡Œã«ç›´é¢ã—ã¦ã„ã¾ã™ã€‚

- ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒã‚°å ±å‘ŠãŒå¢—ãˆã¦ããŸ
  - ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ãŸã‚‰ã‚¢ãƒ—ãƒªãŒè½ã¡ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ˜¡ã€
  - ã€Œæ˜¨æ—¥ã‹ã‚‰é€šçŸ¥ãŒæ¥ã¾ã›ã‚“ğŸ˜…ã€

- ãƒã‚°ã‚’ä¿®æ­£ã™ã‚‹ãŸã³ã«åˆ¥ã®ãƒã‚°ãŒç™ºç”Ÿã—ã¦æ–°æ©Ÿèƒ½ã®é–‹ç™ºã«é›†ä¸­ã§ããªã„

<div class="absolute bottom-10">
  <p>ç¶™ç¶šã—ã¦ã‚¢ãƒ—ãƒªã‚’æˆé•·ã•ã›ã¦ã„ããŸã‚ã«ã¯å“è³ªã‚’ç¶­æŒã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</p>
  <p>ãã“ã§ã€ãƒªãƒªãƒ¼ã‚¹å‰ã®ãƒ†ã‚¹ãƒˆã‚’å°å…¥ã—ã¾ã—ãŸã€‚</p>
</div>

---

ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ä½œã£ã¦ã€ãƒ†ã‚¹ã‚¿ãƒ¼ã‚’é›‡ã„ã€ãƒªãƒªãƒ¼ã‚¹å‰ãƒ†ã‚¹ãƒˆã‚’å°å…¥ã—ã¾ã—ãŸã€‚

ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒã‚°å ±å‘Šã¯æ¸›ã‚Šã€æ–°æ©Ÿèƒ½ã®é–‹ç™ºã«é›†ä¸­ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã—ã‹ã—ã€ã—ã°ã‚‰ãã™ã‚‹ã¨ã¾ãŸæ–°ãŸãªèª²é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚

- ã‚¢ãƒ—ãƒªãŒæˆé•·ã™ã‚‹ã»ã©ãƒªãƒªãƒ¼ã‚¹å‰ãƒ†ã‚¹ãƒˆã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒå¤§ãããªã‚Šå·¥æ•°ãŒå¢—ãˆã¦ããŸ
- ãƒªãƒªãƒ¼ã‚¹æ¯ã«ã»ã¼åŒã˜ãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã„ã‚‹
- ãƒªãƒªãƒ¼ã‚¹é–“éš”ãŒå»¶ã³ã‚‹ã¨ãƒã‚°ã®ç™ºè¦‹ãŒé…ã‚Œã‚‹

<div class="absolute bottom-10">
  <p>è§£æ±ºç­–ã‚’èª¿ã¹ã¦ã„ã‚‹ã¨ "CI" ã¨ã„ã†ã‚‚ã®ã‚’å°å…¥ã™ã‚‹ã¨ã‚ˆã•ãã†ãªã®ã§ã‚‚ã£ã¨èª¿ã¹ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>
  <p align="right">ã¤ã¥ã</p>
</div>

---
layout: section
---

# CI
## Continuous Integration (ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

---

# CI ã¨ã¯ä½•ã‹ï¼Ÿ

<br>

## **è‡ªå‹•ãƒ†ã‚¹ãƒˆ**ã‚’ã—ã¦å“è³ªã‚’ç¶­æŒã—ãªãŒã‚‰é–‹ç™ºã‚’ã™ã‚‹ã“ã¨ã€‚

<div class="absolute bottom-10">
  <p>ä»Šå› CD (ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼) ã¯æ‰±ã„ã¾ã›ã‚“ã€‚</p>
  <p>CD ã¨ã¯ã€è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ã‚¹ãƒˆã‚¢é…ä¿¡ã‚’ã—ã¦ã„ã¡æ—©ããƒ¦ãƒ¼ã‚¶ã«ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’å±Šã‘ã‚‹ã“ã¨ã§ã™ã€‚</p>
</div>

---

# CI ã®ä½ç½®ã¥ã‘

<br>

## ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«

<div grid="~ cols-5 gap-2">

<p class="box" style="background-color: #42a5f5;">è¦ä»¶å®šç¾©</p>
<p class="box" style="background-color: #2196f3;">UI / UX ãƒ‡ã‚¶ã‚¤ãƒ³</p>
<p class="box" style="background-color: #1e88e5;">ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</p>
<p class="box" style="background-color: #1976d2;">ãƒ†ã‚¹ãƒˆ</p>
<p class="box" style="background-color: #1565c0;">ãƒªãƒªãƒ¼ã‚¹</p>

</div>

<div grid="~ cols-4 gap-2">

<p></p>
<p></p>
<p class="box" style="background-color: #ff8f00;">CI</p>
<p></p>

</div>

<style>
p.box {
  color: white;
  height: 100px;
  text-align: center;
  padding-top: 34px;
  border-radius: 4px;
  box-shadow: 2px 2px 2px rgba(0,0,0,0.6);
}
</style>

<div class="absolute bottom-5">
  <p>CI ã¯åˆå­¦è€…ãŒä»Šã™ãèº«ã«ã¤ã‘ã‚‹ã¹ãã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  <p>ã—ã‹ã—ã€ãã®å¿…è¦æ€§ã¯ç†è§£ã—ã€ã„ã¤ã§ã‚‚å§‹ã‚ã‚‰ã‚Œã‚‹æº–å‚™ã‚’ã—ã¦ãŠãã“ã¨ã¯å¤§äº‹ã ã¨æ€ã„ã¾ã™ã€‚</p>
</div>

---

# CI å°å…¥ã®ãƒ¡ãƒªãƒƒãƒˆ

- ãƒ‡ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’é˜²ãã“ã¨ãŒã§ãã‚‹
- ãƒã‚°ã‚’æ—©æœŸã«ç™ºè¦‹ã§ãã‚‹
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã‚„ã™ããªã‚‹

## ãƒ‡ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆãƒ‡ã‚°ãƒ¬ï¼‰ã¨ã¯ï¼Ÿ

æ—¢å­˜æ©Ÿèƒ½ãŒãƒã‚°ã‚‹ã“ã¨ã€‚

- ãƒ‡ã‚°ãƒ¬ãƒ¼ãƒ‰ã®ä¾‹

  - æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸã‚‰æ—¢å­˜æ©Ÿèƒ½ãŒå‹•ã‹ãªããªã£ãŸ
  - SDK ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ãŸã‚‰ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‰ãªããªã£ãŸ

- ãƒ‡ã‚°ãƒ¬ãŒã„ã‹ã«ãƒ¤ãƒã„ã‹ãŒã‚ã‹ã‚‹è¨˜äº‹

  - [ãƒ‡ã‚°ãƒ¬ã‚’ã¶ã¡ã‹ã¾ã—ãŸã®ã§ã€é–‹ç™ºä½œæ¥­ã‚’1é€±é–“ä»¥ä¸Šæ­¢ã‚ã‚‰ã‚ŒãŸè©±ã€‚](http://ht-jp.net/blog/pc/dev-memo/degrade)

---

# CI å°å…¥ã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

<img src="/images/bug.png" class="rounded shadow absolute top-5 right-5" width="290" >

<br>

- å­¦ç¿’ã‚³ã‚¹ãƒˆ

- é–‹ç™ºæ™‚ã®å·¥æ•°ãŒå¢—ãˆã‚‹
  - é–‹ç™ºæ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã™ã‚‹å·¥æ•°ãŒå¢—ãˆã‚‹
    - ãƒã‚°ã‚’æ—©æœŸã«ç™ºè¦‹ã™ã‚‹ã“ã¨ã§å‰Šæ¸›ã§ãã‚‹å·¥æ•°ã‚‚ã‚ã‚‹ãŒï¼ˆâ€»ï¼‰ã€ç·ã˜ã¦å·¥æ•°ã¯å¢—ãˆã‚‹
    - [ãƒã‚°ã®æ—©æœŸæ¤œå‡ºãƒ¡ãƒªãƒƒãƒˆã¨ãã®æ–¹æ³•ï½œã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³ã®ã™ã™ã‚](https://shiftasia.com/ja/column/%E3%83%90%E3%82%B0%E3%81%AE%E6%97%A9%E6%9C%9F%E6%A4%9C%E5%87%BA%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%A8%E3%81%9D%E3%81%AE%E6%96%B9%E6%B3%95/)

  - å¾Œè¿°ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚„é™çš„è§£æã¯å®Ÿè£…ãŒä¸è¦ã§ã™ãã«å°å…¥ãŒå¯èƒ½ï¼ï¼ˆã™ãã«ã‚„ã‚ã†ï¼ï¼‰

---

# CI ã®å°å…¥æ–¹æ³•

<br>

## Flutter ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ CI / CD ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹

- Travis CI
- Circle CI
- Codemagic
- Bitrise
- **GitHub Actions**

<div class="absolute bottom-10">
  <p>
    ã“ã®ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ãŒç„¡ã„æ™‚ä»£ (ã‚¹ãƒãƒ›ãŒç™»å ´ã™ã‚‹å‰ã¾ã§) ã¯ã€è‡ªå‰ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ãŸã¦ã¦ Jenkins ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ç’°å¢ƒæ§‹ç¯‰ã—ã¦ã€ã€ã€ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ãŒã„ã£ã±ã„ã«ãªã£ãŸã‚‰å¤–ä»˜ã‘HDDã¨ã‚Šã¤ã‘ã¦ã€ã€ã€ã€ã—ã°ã‚‰ãé‹ç”¨ã™ã‚‹ã¨HDDãŒãƒ”ãƒ¼ãƒ”ãƒ¼ãªã£ã¦æ•…éšœã—ãŸã‚Šã¨è‹¦åŠ´ãŒçµ¶ãˆã¾ã›ã‚“ã§ã—ãŸã€‚æœ¬å½“ã«æ¥½ã«ãªã‚Šã¾ã—ãŸã€‚
  </p>
  <p>ä»Šå›ã¯ Public ãƒªãƒã‚¸ãƒˆãƒªãªã‚‰å®Œå…¨ç„¡æ–™ã® GitHub Actions ã‚’ã¤ã‹ã£ã¦ã¿ã¾ã™ï¼</p>
</div>

---
layout: section
---

# GitHub Actions

---

# GitHub Actions ã¨ã¯

ãƒªãƒ¢ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚<br>
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ YAML ã¨å‘¼ã°ã‚Œã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã—ã¾ã™ã€‚

- ã‚ˆãã‚ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

  1ï¼ è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ ( CI )<br>
  2ï¼ ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦è‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ ( CD )<br>
  3ï¼ çµæœã‚’ Slack ã«é€šçŸ¥ã™ã‚‹<br>

<br>
<br>

<img src="/images/github-actions.png" class="rounded shadow" width="" >

---

# YAML ã¨ã¯

- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨˜è¿°ã«ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹è¨€èª

- YAML Ain't a Markup Language ( YAML ã¯ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã§ã¯ãªã„) ã®ç•¥ ğŸ˜‚

- ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒæ„å‘³ã‚’ã‚‚ã¤ã®ã§æ³¨æ„

- é›°å›²æ°—ã§æ›¸ãã¨ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦æ²¼ã«ã¯ã¾ã‚‹ã“ã¨ã‚‚

- Flutter ã§ã‚‚ã‚ˆãä½¿ã‚ã‚Œã¦ã„ã‚‹
  - pubspec.yaml
  - analysis_options.yaml
  - etc...

---

# YAML ã®æ›¸ãæ–¹

<div grid="~ cols-2 gap-4">
<div>

ã‚­ãƒ¼ã¨å€¤ãŒã™ã¹ã¦

```yaml
key: value
```

ã‚¹ã‚«ãƒ©ãƒ¼(æ•°å­—ã€æ–‡å­—åˆ—ã€çœŸå½å€¤ï¼‰

```yaml
version: 2
rating: 5.2
name: Flutter
name: 'Flutter'
name: "Flutter"
cache: true
```

è¤‡æ•°è¡Œã®æ–‡å­—åˆ—

```yaml
run: |
  flutter config --enable-macos-desktop
  flutter build macos -t lib/main.dart --release
```

</div>
<div>

ã‚·ãƒ¼ã‚±ãƒ³ã‚¹(é…åˆ—)

```yaml
branches:
  - main
  - develop
```

```yaml
branches: [main, develop]
```

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³(åå‰ä»˜ãé…åˆ—)

```yaml
flutter_test:
  name: Flutter Test
  timeout-minutes: 10
```

```yaml
flutter_test: {name: Flutter Test, timeout-minutes: 10}
```

</div>
</div>

---
layout: section
---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã—ã‚ˆã†

---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆ

<div grid="~ cols-2 gap-4">
<div>

## 3 ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æ§‹æˆ

- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å ( name: )

- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®èµ·å‹•æ¡ä»¶ ( on: )

  - main ãƒ–ãƒ©ãƒ³ãƒã« push ã•ã‚ŒãŸæ™‚
  - ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚ŒãŸæ™‚

- ã‚¸ãƒ§ãƒ– ( jobs: )

  - å®Ÿè¡Œç’°å¢ƒ (OS) ã‚„å‡¦ç†æ‰‹é †ãªã©
  - ã‚¸ãƒ§ãƒ–ã¯è¤‡æ•°å®šç¾©ã§ãã€**å„ã‚¸ãƒ§ãƒ–ã¯ãã‚Œãã‚Œåˆ¥ã€…ã®ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã‚‹**

<arrow x1="300" y1="160" x2="610" y2="110" color="red" width="4" />
<arrow x1="340" y1="200" x2="610" y2="160" color="red" width="4" />
<arrow x1="220" y1="330" x2="610" y2="330" color="red" width="4" />

<div class="absolute bottom-5">
  <p>
    <a href="https://docs.github.com/ja/actions/using-workflows/workflow-syntax-for-github-actions">GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡</a>
  </p>
</div>


</div>
<div>

<center>
<img src="images/struct.png" class="rounded shadow" width="180">
</center>

</div>
</div>

---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åã®å®šç¾©

<div grid="~ cols-2 gap-4">
<div>

<br>

```yaml
name: Flutter CI Basic
```

</div>
<div>

<center>
<img src="images/workflow-name.png" class="rounded shadow">
</center>

</div>
</div>

---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®èµ·å‹•æ¡ä»¶ã®å®šç¾©

<div grid="~ cols-2 gap-4">
<div>

<br>

```yaml
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼èµ·å‹•æ¡ä»¶ã‚’å®šç¾©ã™ã‚‹
on:
  # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä½œæˆ or æ›´æ–°ã•ã‚ŒãŸæ™‚
  pull_request:
    types:
      - opened
      - synchronize

  # main ãƒ–ãƒ©ãƒ³ãƒã« push ã•ã‚ŒãŸæ™‚
  push:
    branches:
      - main
```

</div>
<div>

- ã‚ªã‚¹ã‚¹ãƒ¡ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®èµ·å‹•æ¡ä»¶

  - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä½œæˆã•ã‚ŒãŸæ™‚
  - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ›´æ–°ã•ã‚ŒãŸæ™‚
  - main ãƒ–ãƒ©ãƒ³ãƒã« push ã•ã‚ŒãŸæ™‚


</div>
</div>

---

# ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ã®å®šç¾©

æ¬¡ã®ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ã‚’å®šç¾©ã—ã¦ã¿ã¾ã™ã€‚

```mermaid
%%{init:{'theme':'base','themeVariables':{'primaryColor':'#f0f0f0','primaryTextColor':'#2f2f2f', 'lineColor':'#2f2f2f','textColor':'#2f2f2f','fontSize':'16px','nodeBorder':'0px'}}}%%
flowchart LR
    Start((é–‹å§‹)) --> Prepare(æº–å‚™)
    subgraph ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
    Prepare --> Format(ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
    Format --> Analyze(é™çš„è§£æ)
    Analyze --> Test(ãƒ†ã‚¹ãƒˆ)
    end
    Test --> End((çµ‚äº†))

    classDef anchor fill:#4063DD, color:#ffffff;
    classDef testJob fill:#4063DD, color:#ffffff;
    %% class Start,End anchor;
    class Prepare,Format,Analyze,Test testJob;
```

ãƒ†ã‚¹ãƒˆã«ã¯è‰²ã€…ãªç¨®é¡ã®ãƒ†ã‚¹ãƒˆãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦ GitHub Actions ä¸Šã§å®Ÿè¡Œã§ãã¾ã™ï¼ˆå¤šåˆ†ï¼‰ã€‚

|||
|--|--|
|å˜ä½“ãƒ†ã‚¹ãƒˆ|é–¢æ•°ã®æˆ»ã‚Šå€¤ãŒæœŸå¾…å€¤ã¨ä¸€è‡´ã™ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆ|
|Widget ãƒ†ã‚¹ãƒˆ|Widget ã‚’æ“ä½œï¼ˆã‚¿ãƒƒãƒ—ãªã©ï¼‰ã—ã¦æ„å›³ã—ãŸå‹•ãã‚’ã™ã‚‹ã‹ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆ|
|ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ†ã‚¹ãƒˆ|äº‹å‰ã«æ­£è§£ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¦ãŠãã€å®Ÿéš›ã®ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨æ¯”è¼ƒã‚’ã™ã‚‹ãƒ†ã‚¹ãƒˆ|
|ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ|Driver ã¨å‘¼ã°ã‚Œã‚‹æ“¬ä¼¼çš„ãªãƒ¦ãƒ¼ã‚¶ã‚’ä½¿ã£ã¦å®Ÿéš›ã®æ“ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãƒ†ã‚¹ãƒˆ|

---

# ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ã®å®šç¾©

```yaml
# ã‚¸ãƒ§ãƒ–ã‚’å®šç¾©ã™ã‚‹
# å„ã‚¸ãƒ§ãƒ–ã¯ãã‚Œãã‚Œã¾ã£ãŸãåˆ¥ã€…ã®ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  # æœ€åˆã«å®Ÿè¡Œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
  flutter_test:
    # è¡¨ç¤ºåã®å®šç¾©
    name: Flutter Test
    # ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹OS
    runs-on: ubuntu-latest
    # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ï¼ˆåˆ†ï¼‰
    timeout-minutes: 10
    # ã‚¸ãƒ§ãƒ–ã®æ‰‹é †
    steps:
      ãƒ»ãƒ»ãƒ»
```

timeout-minutes ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ 6 æ™‚é–“ï¼ Private ãƒªãƒã‚¸ãƒˆãƒªã¯å®Ÿè¡Œæ™‚é–“ã«å¿œã˜ã¦èª²é‡‘ã•ã‚Œã¾ã™ã€‚å‡¦ç†ãŒçµ‚ã‚ã‚‰ãªã„ã¾ã¾æ”¾ç½®ã•ã‚Œè«å¤§ãªè«‹æ±‚é¡ã«ã¤ãªãŒã‚‰ãªã„ã‚ˆã† timeout-minutes ã¯å¿…ãšæŒ‡å®šã—ã¾ã—ã‚‡ã†ã€‚

---

# STEP: æº–å‚™

<div grid="~ cols-2 gap-4">
<div>

```yaml
      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout
        uses: actions/checkout@v3
      # fvm ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒãƒ£ãƒãƒ«ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã™ã‚‹
      - name: Check fvm
        uses: kuhnroyal/flutter-fvm-config-action@v1
      # Flutter SDK ã®è¨­å®š
      - name: Setup Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒãƒ£ãƒãƒ«ã¯ fvm ã®å€¤ã‚’ä½¿ã†
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: ${{ env.FLUTTER_CHANNEL }}
          # æ¬¡å›ä»¥é™èµ·å‹•ã‚’é€Ÿãã™ã‚‹ãŸã‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠã
          cache: true
          cache-key: flutter
          cache-path: ${{ runner.tool_cache }}/flutter
      # flutter pub get ã‚’å®Ÿè¡Œ
      - name: Install Flutter dependencies
        run: flutter pub get
```

</div>
<div>

- ã‚¸ãƒ§ãƒ–æ¯ã« OS ã‚’èµ·å‹•ã—ç›´ã—ã¦ã„ã‚‹

- fvm ã¨ã¯ Flutter SDK ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«
  - SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒãƒ¼ãƒ ã§çµ±ä¸€ã§ãã‚‹ã»ã‹ã€SDK ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ãŒã£ãŸã¨ãã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ãªãã¦ã™ã‚€

- subosito/flutter-action@v2 ã«ã‚ˆã£ã¦ SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå›ºå®šã•ã‚Œã‚‹ã®ã§ã€ã“ã‚Œä»¥é™ã®ã‚³ãƒãƒ³ãƒ‰ã¯ `fvm flutter` ã§ã¯ãªã `flutter` ã§å•é¡Œãªã„

- uses ã§ä»–ã®äººãŒä½œã£ãŸä¾¿åˆ©ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å†åˆ©ç”¨ã§ãã‚‹

- `${{ }}` ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå¤‰æ•°ï¼‰ã‚’å‚ç…§ã€[è‰²ã€…ãªå¤‰æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹](https://docs.github.com/ja/actions/learn-github-actions/contexts)
</div>
</div>

---

# STEP: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```yaml
      # ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œ
      # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµæœå¤‰æ›´ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼æ‰±ã„ã«ã™ã‚‹
      - name: Run Flutter format
        run: flutter format --set-exit-if-changed .
```
<br>

<div grid="~ cols-2 gap-4">
<div>

<center>
ğŸ™… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ã„ãªã„
<br>
<br>
<img src="images/format-on-save-no-format.png" class="rounded shadow" width="">
</center>

</div>
<div>

<center>
âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ã„ã‚‹
<br>
<br>
<img src="images/format-on-save-yes-format.png" class="rounded shadow" width="">
</center>

</div>
</div>


---

# STEP: é™çš„è§£æ

<div grid="~ cols-2 gap-4">
<div>

```yaml
      # é™çš„è§£æã‚’å®Ÿè¡Œ
      - name: Run Flutter Analyze
        run: flutter analyze
```

- é™çš„è§£æã®ãƒ¡ãƒªãƒƒãƒˆ
  - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒãƒ¼ãƒ ã§çµ±ä¸€ã§ãã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚ˆã‚Šæœ‰ç›Šãªã‚‚ã®ã«ãªã‚‹
  - ã‚­ãƒ¬ã‚¤ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® [lints](https://pub.dev/packages/lints) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚‚ã‚ˆã„ã—ã€ã‚ˆã‚Šå³ã—ãã—ãŸã‘ã‚Œã° [pedantic_mono](https://pub.dev/packages/pedantic_mono) ãŒã‚ªã‚¹ã‚¹ãƒ¡

</div>
<div>

<img src="images/linter.png" class="rounded shadow" width="">

</div>
</div>

---

# STEP: ãƒ†ã‚¹ãƒˆ

```yaml
      # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
      - name: Run Flutter Test
        run: flutter test
```

Widgets ãƒ†ã‚¹ãƒˆã®ä¾‹

```dart
void main() {
  testWidgets('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒå¢—ãˆã‚‹ã¯ãš', (WidgetTester tester) async {
    // ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹
    await tester.pumpWidget(const MyApp());

    // åˆæœŸè¡¨ç¤ºæ™‚ã¯ 0 ã«ãªã£ã¦ã„ã‚‹ã¯ãš
    expect(find.text('0'), findsOneWidget);
    expect(find.text('1'), findsNothing);

    // +ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã™ã‚‹
    await tester.tap(find.byIcon(Icons.add));
    await tester.pump();

    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒ 1 ã«ãªã£ã¦ã„ã‚‹ã¯ãš
    expect(find.text('0'), findsNothing);
    expect(find.text('1'), findsOneWidget);
  });
}
```

---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹

ä½œæˆã—ãŸ YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ .github/workflows/ ã«ä¿å­˜ã—ã¾ã™ã€‚<br>
ãƒ•ã‚¡ã‚¤ãƒ«åã¯ãªã‚“ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚

<center>
  <img src="images/workflow-files.png" class="rounded shadow" width="480">
</center>

---

# å®Œæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<br>

https://github.com/susatthi/flutter-sample-ci/blob/main/.github/workflows/flutter_ci_basic.yaml

---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å‹•ã‹ã—ã¦ã¿ã‚ˆã†

æº–å‚™ãŒå‡ºæ¥ã¾ã—ãŸã€‚ã•ã£ããä¿®æ­£ã‚’ Commit & Push ã—ã¦ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒèµ·å‹•ã—ã¾ã—ãŸ ğŸ‰

<center>
<video controls="controls" width="700">
<source src="/movies/run-basic.mov">
</video>
</center>


---
layout: section
---

# ãƒ†ã‚¹ãƒˆçµæœã‚’ GitHub Actions ä¸Šã«è¡¨ç¤ºã™ã‚‹

---

# ãƒ†ã‚¹ãƒˆçµæœã‚’ GitHub Actions ä¸Šã«è¡¨ç¤ºã™ã‚‹

GitHub Actions ä¸Šã§å®Ÿè¡Œã—ãŸãƒ†ã‚¹ãƒˆã®çµæœã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€ã‚ã–ã‚ã–å®Ÿè¡Œãƒ­ã‚°ã‚’è¦‹ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã•ã•ã£ã¨ç¢ºèªãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ãƒ†ã‚¹ãƒˆçµæœã‚’ GitHub Actions ä¸Šã«è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

```mermaid
%%{init:{'theme':'base','themeVariables':{'primaryColor':'#f0f0f0','primaryTextColor':'#2f2f2f', 'lineColor':'#2f2f2f','textColor':'#2f2f2f','fontSize':'16px','nodeBorder':'0px'}}}%%
flowchart LR
    Start((é–‹å§‹)) --> Prepare(æº–å‚™)
    subgraph ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
    Prepare --> Format(ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
    Format --> Analyze(é™çš„è§£æ)
    Analyze --> Test(ãƒ†ã‚¹ãƒˆ)
    Test --> Report(ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º)
    end
    Report --> End((çµ‚äº†))

    classDef anchor fill:#4063DD, color:#ffffff;
    classDef testJob fill:#4063DD, color:#ffffff;
    classDef buildJob fill:#d32f2f, color:#ffffff;
    classDef reportJob fill:#437C40, color:#ffffff;
    %% class Start,End anchor;
    class Prepare,Format,Analyze,Test,Report testJob;
    class BuildAndroid,BuildiOS buildJob;
    class NotifySlack reportJob;
```

<square width="200" height="200" />

<img class="absolute top-31 left-162" src="/images/square.png" width="180" />
    
<br>

<center>
  <img src="images/test-report-sample.png" class="rounded shadow" width="500">
</center>

---

# STEP: ãƒ†ã‚¹ãƒˆï¼†ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤ºã™ã‚‹

ã€ŒSTEP: é™çš„è§£æã€ã¾ã§ã¯åŒã˜ã§ã™ã€‚

```yaml {2,4,6-}
      # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
      # ã‚ã¨ã§ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤ºã™ã‚‹ã®ã§ log ã«å‡ºåŠ›ã™ã‚‹
      - name: Run Flutter Test
        run: flutter test --machine > test-report.log

      # ãƒ†ã‚¹ãƒˆçµæœã‚’ GitHub Actions ã«è¡¨ç¤ºã™ã‚‹
      - name: Report Test
        uses: dorny/test-reporter@v1
        # ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤ºã™ã‚‹ã®ã§ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã‚‚å®Ÿè¡Œã™ã‚‹
        if: always()
        with:
          name: Flutter Test Report
          path: test-report.log
          reporter: flutter-json
```

- `if: ${{ <expression> }}` ã§ if æ–‡ã®ã‚ˆã†ãªã“ã¨ãŒã§ãã‚‹ ( if ã® `${{ }}` ã¯çœç•¥å¯ )
- `always()` ã¯ã‚‚ã¨ã‚‚ã¨ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§å¸¸ã« `true` ã‚’è¿”ã™
- ã»ã‹ã«ã‚‚ [ã„ã‚ã„ã‚](https://docs.github.com/ja/actions/learn-github-actions/expressions) ã‚ã‚Šã¾ã™
---

# GitHub ã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹

<div grid="~ cols-2 gap-4">
<div>

- Bot ãŒ GITHUB_TOKEN ã‚’ä½¿ã£ã¦æ›¸ãè¾¼ã¿ã‚’è¡Œã†ãŸã‚ã®æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã€‚


</div>
<div>
<img src="images/permissions.png" class="rounded shadow">

- æ³¨æ„ç‚¹
  - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè¤‡æ•°ã‚ã‚‹ã¨ã€åˆ¥ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã†ã§ã™ ğŸ˜…

</div>
</div>

---

# å®Œæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<br>

https://github.com/susatthi/flutter-sample-ci/blob/main/.github/workflows/flutter_ci_report_test_result.yaml

---

# ãƒ†ã‚¹ãƒˆçµæœãŒè¡¨ç¤ºå‡ºæ¥ã¾ã—ãŸ ğŸ‰

https://github.com/susatthi/github-search/runs/6402045178?check_suite_focus=true

<center>
<img src="images/test-report-sample.png" class="rounded shadow" width="600">
</center>

---
layout: section
---

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã‚ˆã†

---

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã¨ã¯ï¼Ÿ

- ãƒ†ã‚¹ãƒˆã®ç¶²ç¾…ç‡

- ã‚³ãƒ¼ãƒ‰å…¨ä½“ã®ã†ã¡ãƒ†ã‚¹ãƒˆã—ãŸãƒ«ãƒ¼ãƒˆãŒå ã‚ã‚‹å‰²åˆã®ã“ã¨

- Codecov ã‚’åˆ©ç”¨ã—ã¾ã™

<center>
<img src="images/codecov.png" class="rounded shadow">
</center>
---

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã‚ˆã†

ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å¯è¦–åŒ–ã—ã¦ç¶²ç¾…ç‡ã‚’ä¸Šã’ã‚‹ã“ã¨ã¯å“è³ªå‘ä¸Šã«å½¹ç«‹ã¡ã¾ã™ã€‚ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹ Codecov ã«çµæœã‚’é€ä¿¡ã—ã€Codecov ã®ã‚µã‚¤ãƒˆä¸Šã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã®çµæœã‚’è¦‹ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

```mermaid
%%{init:{'theme':'base','themeVariables':{'primaryColor':'#f0f0f0','primaryTextColor':'#2f2f2f', 'lineColor':'#2f2f2f','textColor':'#2f2f2f','fontSize':'16px','nodeBorder':'0px'}}}%%
flowchart LR
    Start((é–‹å§‹)) --> Prepare(æº–å‚™)
    subgraph ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
    Prepare --> Format(ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
    Format --> Analyze(é™çš„è§£æ)
    Analyze --> Test(ãƒ†ã‚¹ãƒˆ)
    Test --> Report(ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º)
    Report --> UploadCoverage(Codecovã«çµæœã‚’é€ä¿¡)
    end
    UploadCoverage --> End((çµ‚äº†))

    classDef anchor fill:#4063DD, color:#ffffff;
    classDef testJob fill:#4063DD, color:#ffffff;
    classDef buildJob fill:#d32f2f, color:#ffffff;
    classDef reportJob fill:#437C40, color:#ffffff;
    %% class Start,End anchor;
    class Prepare,Format,Analyze,Test,Report,UploadCoverage testJob;
    class BuildAndroid,BuildiOS buildJob;
    class NotifySlack reportJob;
```

<img class="absolute top-31 left-170" src="/images/square.png" width="170" />

<div grid="~ cols-2 gap-4">
<div>

<img src="images/codecov-overview-1.png" class="rounded shadow">

</div>
<div>

<img src="images/codecov-overview-2.png" class="rounded shadow">

</div>
</div>

---

# STEP: Codecovã«çµæœã‚’é€ä¿¡

```yaml {3,5,9-}
      # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
      # ã‚ã¨ã§ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤ºã™ã‚‹ã®ã§ log ã«å‡ºåŠ›ã™ã‚‹
      # Codecovã«çµæœã‚’é€ä¿¡ã™ã‚‹ã®ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚ã‚Šã§å®Ÿè¡Œã™ã‚‹
      - name: Run Flutter Test
        run: flutter test --machine --coverage > test-report.log

      ãƒ»ãƒ»ãƒ»

      # Codecov ã«çµæœã‚’é€ä¿¡
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v2
        with:
          file: coverage/lcov.info
          fail_ci_if_error: true
          flags: unittests
          verbose: true
```

---

# å®Œæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<br>

https://github.com/susatthi/flutter-sample-ci/blob/main/.github/workflows/flutter_ci_coverage.yaml

---

# Codecov ã§çµæœã‚’ç¢ºèªã§ãã¾ã—ãŸ ğŸ‰

https://app.codecov.io/gh/susatthi/github-search

<center>
<img src="images/codecov-overview-sample.png" class="rounded shadow" width="600">
</center>

---

# PR ã®ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚‚çµæœã‚’ç¢ºèªã§ãã¾ã™ ğŸ‰

https://github.com/susatthi/github-search/pull/113

<center>
<img src="images/codecov-pr.png" class="rounded shadow" width="600">
</center>

---

# README ã«ãƒãƒƒã‚¸ã‚’ä»˜ã‘ã¦ãƒ‰ãƒ¤ã‚Œã¾ã™ ğŸ‰

https://github.com/susatthi/github-search

<center>
<img src="images/codecov-readme.png" class="rounded shadow" width="600">
</center>

---
layout: section
---

# CI ã®çµæœã‚’ Slack ã«é€šçŸ¥ã—ã‚ˆã†

---

# CI ã®çµæœã‚’ Slack ã«é€šçŸ¥ã—ã‚ˆã†

ãƒ†ã‚¹ãƒˆã§å¤±æ•—ã—ãŸã¨ãã¯ã„ã¡æ—©ãçŸ¥ã‚ŠãŸã„ã§ã™ã‚ˆã­ã€‚ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ Slack ã«çµæœã‚’é€šçŸ¥ã§ãã‚Œã°ã†ã‚Œã—ã„ã§ã™ã€‚ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```mermaid
%%{init:{'theme':'base','themeVariables':{'primaryColor':'#f0f0f0','primaryTextColor':'#2f2f2f', 'lineColor':'#2f2f2f','textColor':'#2f2f2f','fontSize':'16px','nodeBorder':'0px'}}}%%
flowchart LR
    Start((é–‹å§‹)) --> Prepare(æº–å‚™)
    subgraph ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
    Prepare --> Format(ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
    Format --> Analyze(é™çš„è§£æ)
    Analyze --> Test(ãƒ†ã‚¹ãƒˆ)
    Test --> Report(ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º)
    Report --> UploadCoverage(Codecovã«çµæœã‚’é€ä¿¡)
    end
    subgraph ãƒ¬ãƒãƒ¼ãƒˆã‚¸ãƒ§ãƒ–
    UploadCoverage ---> NotifySlack(Slackã«çµæœã‚’é€ä¿¡)
    end
    NotifySlack --> End((çµ‚äº†))

    classDef anchor fill:#4063DD, color:#ffffff;
    classDef testJob fill:#4063DD, color:#ffffff;
    classDef buildJob fill:#d32f2f, color:#ffffff;
    classDef reportJob fill:#437C40, color:#ffffff;
    %% class Start,End anchor;
    class Prepare,Format,Analyze,Test,Report,UploadCoverage testJob;
    class BuildAndroid,BuildiOS buildJob;
    class NotifySlack reportJob;
```

<img class="absolute top-32 left-180" src="/images/square.png" width="160" />

<center>
<img src="images/slack-sample.png" class="rounded shadow" width="360">
</center>

---

# Slack ã®æº–å‚™

- Incoming Webhooks ã‚¢ãƒ—ãƒªã‚’ Slack ã«è¿½åŠ ã— Webhook URL ã‚’å–å¾—ã™ã‚‹

<center>
<video controls="controls" width="650">
<source src="/movies/incoming-webhooks.mp4">
</video>
</center>

---

# GitHub ã®æº–å‚™

- Webhook URL ã‚’ GitHub Secrets ã« SLACK_WEBHOOK_URL ã¨ã„ã†åå‰ã§ç™»éŒ²ã™ã‚‹

<center>
<img src="images/github-secrets.png" class="rounded shadow" width="550">
</center>

---

# Slack é€šçŸ¥ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```yaml
  # Slacké€šçŸ¥ã‚¸ãƒ§ãƒ–
  notify_slack:
    name: Notify to Slack
    # å‰ã®ã‚¸ãƒ§ãƒ–ã®æˆå¦ã«ã‚ˆã‚‰ãšå¸¸ã«å®Ÿè¡Œã™ã‚‹
    if: ${{ always() }}
    # ã™ã¹ã¦ã®ã‚¸ãƒ§ãƒ–ãŒçµ‚äº†ã—ãŸã‚‰å®Ÿè¡Œã™ã‚‹
    needs:
      - flutter_test
    # ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹OS
    runs-on: ubuntu-latest
    # ã“ã“ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ steps é…ä¸‹ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
    env:
      SLACK_USERNAME: GitHub Actions
      SLACK_ICON: https://raw.githubusercontent.com/github/explore/2c7e603b797535e5ad8b4beb575ab3b7354666e1/topics/actions/actions.png
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
```

</div>
<div>

```yaml
    # ã‚¸ãƒ§ãƒ–ã®æ‰‹é †
    steps:
      # ã™ã¹ã¦æˆåŠŸã—ãŸã¨ã
      - name: Notify Success
        if: ${{ !contains(needs.*.result, 'failure') }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_TITLE: SUCCESS TEST!
          SLACK_COLOR: good
      # ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ãŸã¨ã
      - name: Notify Failure Test
        if: ${{ needs.flutter_test.result == 'failure' }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_TITLE: FAILURE TEST ...
          SLACK_COLOR: danger
```

</div>
</div>

---

# å®Œæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<br>

https://github.com/susatthi/flutter-sample-ci/blob/main/.github/workflows/flutter_ci_notify_slack.yaml

---

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®çµæœãŒ Slack ã«é€šçŸ¥ã•ã‚Œã¾ã—ãŸ ğŸ‰
https://flutteruniv.slack.com/archives/C037LFDNF39/p1652342741852409

<center>
<img src="images/slack-sample.png" class="rounded shadow" width="450">
</center>

---

ã“ã“ã¾ã§ã§ãã‚‹ã¨ CI ã¨ã—ã¦ååˆ†æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã§ã‚‚ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ã¯ã ã‚‹ãã†ã§ã™ã‚ˆã­ã€‚

ç‰¹ã«é€”ä¸­ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¯ã˜ã‚ã‚‹ã®ã¯æœ¬å½“ã«ã ã‚‹ã„ã§ã™ã€‚ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ã¯ã‚‚ã®ã™ã”ãå¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ãŒé«˜ã„ã§ã™ã€‚

ã§ã‚‚ã€ã„ã¤ã§ã‚‚ãƒ†ã‚¹ãƒˆå§‹ã‚ã‚‰ã‚Œã‚‹ç’°å¢ƒã‚’æ•´ãˆã¦ãŠã‘ã°ã€ãã®ãƒãƒ¼ãƒ‰ãƒ«ãŒå°‘ã—ä¸‹ãŒã‚‹ã¨æ€ã„ã¾ã™ã€‚

ãœã²ã€å‡ºæ¥ã‚‹ã¨ã“ã‚ã‹ã‚‰ CI ã‚’å°å…¥ã—ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ

<br>
<br>

ã“ã“ã‹ã‚‰å…ˆã®ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã¯ã¶ã£ã¡ã‚ƒã‘å°å…¥ã—ãªãã¦ã‚‚ã‚ˆã„ã§ã™ãŒã€CD (ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼) ã‚’ã‚„ã‚‹å ´åˆã«ã¯å¿…é ˆã«ãªã‚Šã¾ã™ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

---
layout: section
---

# Android ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰

---

# Android ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰

```mermaid
%%{init:{'theme':'base','themeVariables':{'primaryColor':'#f0f0f0','primaryTextColor':'#2f2f2f', 'lineColor':'#2f2f2f','textColor':'#2f2f2f','fontSize':'16px','nodeBorder':'0px'}}}%%
flowchart LR
    Start((é–‹å§‹)) --> Prepare(æº–å‚™)
    subgraph ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
    Prepare --> Format(ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
    Format --> Analyze(é™çš„è§£æ)
    Analyze --> Test(ãƒ†ã‚¹ãƒˆ)
    Test --> Report(ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º)
    Report --> UploadCoverage(Codecovã«çµæœã‚’é€ä¿¡)
    end
    subgraph ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–
    UploadCoverage --> BuildAndroid(Androidãƒ“ãƒ«ãƒ‰)
    end
    subgraph ãƒ¬ãƒãƒ¼ãƒˆã‚¸ãƒ§ãƒ–
    BuildAndroid ---> NotifySlack(Slackã«çµæœã‚’é€ä¿¡)
    end
    NotifySlack --> End((çµ‚äº†))

    classDef anchor fill:#4063DD, color:#ffffff;
    classDef testJob fill:#4063DD, color:#ffffff;
    classDef buildJob fill:#d32f2f, color:#ffffff;
    classDef reportJob fill:#437C40, color:#ffffff;
    %% class Start,End anchor;
    class Prepare,Format,Analyze,Test,Report,UploadCoverage testJob;
    class BuildAndroid,BuildiOS buildJob;
    class NotifySlack reportJob;
```

<img class="absolute top-22 left-153" src="/images/square.png" width="130" />

<br>

- ãƒ†ã‚¹ãƒˆã®çµæœã¯æ—©ãçŸ¥ã‚ŠãŸã„ã®ã§ãƒ“ãƒ«ãƒ‰ã‚ˆã‚Šã‚‚ãƒ†ã‚¹ãƒˆã‚’å„ªå…ˆã™ã‚‹
- ãƒ“ãƒ«ãƒ‰ã¯ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ãŸã¨ãã®ã¿å®Ÿè¡Œã™ã‚‹
- ã‚‚ã— Android ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ãŸã‚‰ Slack ã¸ã®é€šçŸ¥æ™‚ã«ãã®æ—¨ã‚’å«ã‚ã‚‹

---

# Android ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 

ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ã¨åŒã˜ã‚ˆã†ãªæº–å‚™ãŒå¿…è¦ã€‚ã€‚ã€‚CircleCI ã® commands ã®ã‚ˆã†ã« Step ã‚’ãƒ¡ã‚½ãƒƒãƒ‰åŒ–ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã‚’æœŸå¾…ã€‚

<div grid="~ cols-2 gap-4">
<div>

```yaml
  # Android ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–
  flutter_build_android:
    name: Flutter Build for Android
    # ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ãŒæˆåŠŸã—ãŸã‚‰å®Ÿè¡Œã™ã‚‹
    needs:
      - flutter_test
    # ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹OS
    runs-on: ubuntu-latest
    # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ï¼ˆåˆ†ï¼‰
    timeout-minutes: 10
    # ã‚¸ãƒ§ãƒ–ã®æ‰‹é †
    steps:
      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout
        uses: actions/checkout@v3
      # fvm ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒãƒ£ãƒãƒ«ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã™ã‚‹
      - name: Check fvm
        uses: kuhnroyal/flutter-fvm-config-action@v1
      # Flutter SDK ã®è¨­å®š
      - name: Setup Flutter SDK
        uses: subosito/flutter-action@v2
```

</div>
<div>

```yaml
        with:
          # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒãƒ£ãƒãƒ«ã¯ fvm ã®å€¤ã‚’ä½¿ã†
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: ${{ env.FLUTTER_CHANNEL }}
          # æ¬¡å›ä»¥é™èµ·å‹•ã‚’é€Ÿãã™ã‚‹ãŸã‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠã
          cache: true
          cache-key: flutter
          cache-path: ${{ runner.tool_cache }}/flutter
      # flutter pub get ã‚’å®Ÿè¡Œ
      - name: Install Flutter dependencies
        run: flutter pub get
      # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
      - name: Build for Android
        run: flutter build appbundle -t lib/main.dart --release
```

</div>
</div>

---

# Slack é€šçŸ¥ã‚¸ãƒ§ãƒ–ã‚’ä¿®æ­£

<div grid="~ cols-2 gap-4">
<div>

```yaml {9}
  # Slacké€šçŸ¥ã‚¸ãƒ§ãƒ–
  notify_slack:
    name: Notify to Slack
    # å‰ã®ã‚¸ãƒ§ãƒ–ã®æˆå¦ã«ã‚ˆã‚‰ãšå¸¸ã«å®Ÿè¡Œã™ã‚‹
    if: ${{ always() }}
    # ã™ã¹ã¦ã®ã‚¸ãƒ§ãƒ–ãŒçµ‚äº†ã—ãŸã‚‰å®Ÿè¡Œã™ã‚‹
    needs:
      - flutter_test
      - flutter_build_android
    # ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹OS
    runs-on: ubuntu-latest
    # ã“ã“ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ steps é…ä¸‹ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
    env:
      SLACK_USERNAME: GitHub Actions
      SLACK_ICON: https://raw.githubusercontent.com/github/explore/2c7e603b797535e5ad8b4beb575ab3b7354666e1/topics/actions/actions.png
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
```

</div>
<div>

```yaml {17-}
    # ã‚¸ãƒ§ãƒ–ã®æ‰‹é †
    steps:
      # ã™ã¹ã¦æˆåŠŸã—ãŸã¨ã
      - name: Notify Success
        if: ${{ !contains(needs.*.result, 'failure') }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_TITLE: SUCCESS TEST AND BUILD!
          SLACK_COLOR: good
      # ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ãŸã¨ã
      - name: Notify Failure Test
        if: ${{ needs.flutter_test.result == 'failure' }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_TITLE: FAILURE TEST ...
          SLACK_COLOR: danger
      # Android ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã—ãŸã¨ã
      - name: Notify Failure Build for Android
        if: ${{ needs.flutter_build_android.result == 'failure' }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_TITLE: FAILURE BUILD ANDROID ...
          SLACK_COLOR: danger
```

</div>
</div>

---

# å®Œæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<br>

https://github.com/susatthi/flutter-sample-ci/blob/main/.github/workflows/flutter_ci_build_android.yaml

---

# Android ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ ğŸ‰

https://github.com/susatthi/flutter-sample-ci/actions/runs/2318359074

<center>
<img src="images/android-build.png" class="rounded shadow" width="800">
</center>

---
layout: section
---

# iOS ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰

---

# iOS ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰

```mermaid
%%{init:{'theme':'base','themeVariables':{'primaryColor':'#f0f0f0','primaryTextColor':'#2f2f2f', 'lineColor':'#2f2f2f','textColor':'#2f2f2f','fontSize':'16px','nodeBorder':'0px'}}}%%
flowchart LR
    Start((é–‹å§‹)) --> Prepare(æº–å‚™)
    subgraph ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–
    Prepare --> Format(ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
    Format --> Analyze(é™çš„è§£æ)
    Analyze --> Test(ãƒ†ã‚¹ãƒˆ)
    Test --> Report(ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º)
    Report --> UploadCoverage(Codecovã«çµæœã‚’é€ä¿¡)
    end
    subgraph ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–
    UploadCoverage --> BuildAndroid(Androidãƒ“ãƒ«ãƒ‰)
    UploadCoverage --> BuildiOS(iOSãƒ“ãƒ«ãƒ‰)
    end
    subgraph ãƒ¬ãƒãƒ¼ãƒˆã‚¸ãƒ§ãƒ–
    BuildAndroid ---> NotifySlack(Slackã«çµæœã‚’é€ä¿¡)
    BuildiOS ---> NotifySlack
    end
    NotifySlack --> End((çµ‚äº†))

    classDef anchor fill:#4063DD, color:#ffffff;
    classDef testJob fill:#4063DD, color:#ffffff;
    classDef buildJob fill:#d32f2f, color:#ffffff;
    classDef reportJob fill:#437C40, color:#ffffff;
    %% class Start,End anchor;
    class Prepare,Format,Analyze,Test,Report,UploadCoverage testJob;
    class BuildAndroid,BuildiOS buildJob;
    class NotifySlack reportJob;
```

<img class="absolute top-46 left-158" src="/images/square.png" width="80" />

- Android ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã¨ä¸¦åˆ—ã«è¡Œã†ã“ã¨ãŒã§ãã‚‹

- Private ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€Linux (Android) ã® 10 å€ã®åˆ©ç”¨æ–™é‡‘ãŒã‹ã‹ã‚‹ã®ã§æ³¨æ„ ğŸ˜–
  - https://docs.github.com/ja/billing/managing-billing-for-github-actions/about-billing-for-github-actions

---

# iOS ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 

åŸºæœ¬çš„ã«ã¯ Android ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã®è¿½åŠ ã¨åŒã˜

<div grid="~ cols-2 gap-4">
<div>

```yaml
  # iOS ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–
  flutter_build_ios:
    name: Flutter Build for iOS
    # ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ãŒæˆåŠŸã—ãŸã‚‰å®Ÿè¡Œã™ã‚‹
    needs:
      - flutter_test
    # ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹OS
    runs-on: macos-latest
    # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ï¼ˆåˆ†ï¼‰
    timeout-minutes: 10
    # ã‚¸ãƒ§ãƒ–ã®æ‰‹é †
    steps:
      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout
        uses: actions/checkout@v3
      # fvm ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒãƒ£ãƒãƒ«ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã™ã‚‹
      - name: Check fvm
        uses: kuhnroyal/flutter-fvm-config-action@v1
```

</div>
<div>

```yaml
      # Flutter SDK ã®è¨­å®š
      - name: Setup Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒãƒ£ãƒãƒ«ã¯ fvm ã®å€¤ã‚’ä½¿ã†
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: ${{ env.FLUTTER_CHANNEL }}
          # æ¬¡å›ä»¥é™èµ·å‹•ã‚’é€Ÿãã™ã‚‹ãŸã‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠã
          cache: true
          cache-key: flutter
          cache-path: ${{ runner.tool_cache }}/flutter
      # flutter pub get ã‚’å®Ÿè¡Œ
      - name: Install Flutter dependencies
        run: flutter pub get
```

</div>
</div>

---

# iOS ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 

iOS ã¯ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¨è¨¼æ˜æ›¸ãŒå¿…è¦

```yaml
      # ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å–ã‚Šè¾¼ã¿
      - name: Import Provisioning Profile
        run: |
          mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
          touch ~/Library/MobileDevice/Provisioning\ Profiles/decoded.mobileprovision
          echo -n '${{ secrets.APPLE_PROVISIONING_PROFILE }}' | base64 -d -o ~/Library/MobileDevice/Provisioning\ Profiles/decoded.mobileprovision
      # è¨¼æ˜æ›¸ã®å–ã‚Šè¾¼ã¿
      - name: Import Code-Signing Certificates
        uses: Apple-Actions/import-codesign-certs@v1
        with:
          p12-file-base64: ${{ secrets.APPLE_CERTIFICATES_P12 }}
          p12-password: ${{ secrets.APPLE_CERTIFICATE_PASSWORD }}
      # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
      - name: Build for iOS
        run: flutter build ipa -t lib/main.dart --release
```

---

# Slack é€šçŸ¥ã‚¸ãƒ§ãƒ–ã‚’ä¿®æ­£

<div grid="~ cols-2 gap-4">
<div>

```yaml {10}
  # Slacké€šçŸ¥ã‚¸ãƒ§ãƒ–
  notify_slack:
    name: Notify to Slack
    # å‰ã®ã‚¸ãƒ§ãƒ–ã®æˆå¦ã«ã‚ˆã‚‰ãšå¸¸ã«å®Ÿè¡Œã™ã‚‹
    if: ${{ always() }}
    # ã™ã¹ã¦ã®ã‚¸ãƒ§ãƒ–ãŒçµ‚äº†ã—ãŸã‚‰å®Ÿè¡Œã™ã‚‹
    needs:
      - flutter_test
      - flutter_build_android
      - flutter_build_ios
    # ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹OS
    runs-on: ubuntu-latest
    # ã“ã“ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ steps é…ä¸‹ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
    env:
      SLACK_USERNAME: GitHub Actions
      SLACK_ICON: https://raw.githubusercontent.com/github/explore/2c7e603b797535e5ad8b4beb575ab3b7354666e1/topics/actions/actions.png
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
```

</div>
<div>

```yaml {4-}
    # ã‚¸ãƒ§ãƒ–ã®æ‰‹é †
    steps:
      ãƒ»ãƒ»ãƒ»
      # iOS ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã—ãŸã¨ã
      - name: Notify Failure Build for iOS
        if: ${{ needs.flutter_build_ios.result == 'failure' }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_TITLE: FAILURE BUILD IOS ...
          SLACK_COLOR: danger
```

</div>
</div>
---

# GitHub ã®è¨­å®š

<br>
GitHub Secrets ã«ä¸‹è¨˜ã‚’ç™»éŒ²ã™ã‚‹

|     |     |
| --- | --- |
| APPLE_CERTIFICATES_P12|iOS ã‚¢ãƒ—ãƒªã®ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªè¨¼æ˜æ›¸ ( p12 ) ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—|
|APPLE_CERTIFICATE_PASSWORD|è¨¼æ˜æ›¸ ( p12 ) ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã™ã¨ãã«è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰|
|APPLE_PROVISIONING_PROFILE|ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—|

<div class="absolute bottom-10">
  <p>å‚è€ƒã‚µã‚¤ãƒˆ:
    <a href="https://qiita.com/sakusaku3939/items/a2d0bc082d82f03a66a1">ã€Flutterã€‘Github Actionã§iOSã‚¢ãƒ—ãƒªã‚’DeployGateã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹</a>
  </p>
</div>

---

# iOS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£

- XCodeã‚’é–‹ã„ã¦ã€Runnerã‚’é¸æŠã—ã¦ã€Signing & Capabilities ã® Siging ã® Automatically manage signing ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã€Provisioning Profile ã‚’é©åˆ‡ã«è¨­å®šã™ã‚‹

<center>
<video controls="controls" width="600">
<source src="/movies/xcode.mp4">
</video>
</center>

---

# å®Œæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<br>

https://github.com/susatthi/flutter-sample-ci/blob/main/.github/workflows/flutter_ci_build_ios.yaml

---

# iOS ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ ğŸ‰

https://github.com/susatthi/flutter-sample-ci/actions/runs/2318359077

<center>
<img src="images/ios-build.png" class="rounded shadow">
</center>

---
layout: section
---

# å®Ÿä¾‹

---

# macOS, Windows, Web ã®ãƒ“ãƒ«ãƒ‰

https://github.com/susatthi/github-search/actions/runs/2311927219

<center>
<img src="images/github-search.png" class="rounded shadow" width="480">
</center>

---

# è¤‡æ•° OS Ã— è¤‡æ•° SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã®ãƒ†ã‚¹ãƒˆ
https://github.com/susatthi/roggle/actions/runs/2298012766

<center>
<img src="images/roggle-test.png" class="rounded shadow" width="660">
</center>

---
layout: section
---

# Tips

---

# ä¿å­˜æ™‚è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã—ã‚ˆã†

ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã‚„ã™ããªã‚Šã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæ¥½ã«ãªã‚Šã¾ã™ã—ã€`{ }` ã‚„ `[ ]` ã®å¯¾å¿œãƒŸã‚¹ã‚‚æ¸›ã‚Šã¾ã™ã€‚

<div grid="~ cols-2 gap-4">
<div>

<img src="images/format-on-save.png" class="rounded shadow">

</div>
<div>

<img src="images/android-studio-format.gif" class="rounded shadow">

</div>
</div>

---

# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆã‚’æ¥½ã«ã—ã‚ˆã†

Push å‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’ã—ã¾ã™ãŒã€æ¯å›ã‚³ãƒãƒ³ãƒ‰æ‰“ã¤ã®ãŒé¢å€’ã§ã™ã€‚ãã“ã§ [ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’æ¥½ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/susatthi/flutter-sample-ci/blob/main/bin/flutter_test) ã‚’ä½¿ã£ã¦é™çš„è§£æï¼‹ãƒ†ã‚¹ãƒˆã‚’æ¥½ã«å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

<center>
<video controls="controls" width="630">
<source src="/movies/local-test.mp4">
</video>
</center>

---
layout: section
---

# ã‚³ãƒ©ãƒ 

---

# 2000 å¹´ä»£ã® CI

## Git ä»¥å‰ã® CVS / SVN ( é›†ä¸­ç®¡ç†æ–¹å¼ ) å…¨ç››æœŸ

- GitHub ãŒç™»å ´ã™ã‚‹ä»¥å‰ã¯ä¼šç¤¾å†…ã« SVN / VCS ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚µãƒ¼ãƒã‚’é‹ç”¨
- [Jenkins](https://cloudbees.techmatrix.jp/jenkins/) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚µãƒ¼ãƒã« CI ã‚’æ§‹ç¯‰

<center>

<img src="https://www.dcom-web.co.jp/wp-content/uploads/2016/01/img_dcom_Jenkins2.jpg" class="rounded shadow" width="600" />

https://www.dcom-web.co.jp/technology/jenkins/

</center>

---

# ãŠé‡‘ã‚’æ›ã‘ãšã« iOS ãƒ“ãƒ«ãƒ‰ã‚’ã™ã‚‹æ–¹æ³•

## Jenkins ã‚’ä½¿ã†ã¨ã„ã†é¸æŠè‚¢

Private ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€Linux (Android) ã® 10 å€ã®åˆ©ç”¨æ–™é‡‘ãŒã‹ã‹ã‚‹ã®ã§ã€åˆ©ç”¨ã‚’èºŠèº‡ã—ã¡ã‚ƒã„ã¾ã™ã€‚

- ä½¿ã‚ãªããªã£ãŸ Mac ãªã©ã« Jenkins ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- Jenkins ã«ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ§‹ç¯‰


<div class="absolute bottom-10">
  <p>Xcode ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¨ã‹ã€è¨¼æ˜æ›¸ã‚„ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†ãŒé¢å€’ãªã®ã§æ­£ç›´ã‚ªã‚¹ã‚¹ãƒ¡ã¯ã—ã¾ã›ã‚“ã€‚</p>
  <p>ã§ã™ãŒã€å¤šãã® Private ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚‹å ´åˆã€ã‚³ã‚¹ãƒˆé¢ã§æœ‰åˆ©ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
</div>

---

# ãƒã‚°ã¯å¾Œå·¥ç¨‹ã«ãªã‚‹ã»ã©å·¥æ•°ãŒã‹ã‹ã‚‹

é¡§å®¢ã«ã‚‚ã‚ˆã‚Šã¾ã™ã€ç‰¹ã«å—è¨—é–‹ç™ºã«ãªã‚‹ã¨é¡§å®¢éƒ½åˆã®åº¦åˆã„ãŒå¢—ãˆã‚‹ã®ã§é¡•è‘—ã€‚ä¾‹ãˆã°è‡´å‘½çš„ãªãƒã‚°ãŒå‡ºã‚‹ã¨ã€ç·Šæ€¥å¯¾å¿œã§åŸå› èª¿æŸ»ã¨ä¿®æ­£ã€ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ç¢ºèªãƒ†ã‚¹ãƒˆã€å½±éŸ¿ç¯„å›²ãƒ†ã‚¹ãƒˆï¼‰ã€ãƒªãƒªãƒ¼ã‚¹ã€é¡§å®¢ã¸å ±å‘Šã€å†ç™ºé˜²æ­¢ç­–ã®æç¤ºã€ã€ã€ã¨ã€ä¿®æ­£ä»¥å¤–ã«ã‚„ã‚‹ã“ã¨ãŒå¢—ãˆã¦ã—ã¾ã„ã¾ã™ã€‚ãƒã‚°ã¯æ—©æœŸç™ºè¦‹ãƒ»æ—©æœŸæ”¹ä¿®ã«ã“ã—ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

<center>
<img src="/images/bug.png" class="rounded shadow" width="360" >

[ãƒã‚°ã®æ—©æœŸæ¤œå‡ºãƒ¡ãƒªãƒƒãƒˆã¨ãã®æ–¹æ³•ï½œã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³ã®ã™ã™ã‚](https://shiftasia.com/ja/column/%E3%83%90%E3%82%B0%E3%81%AE%E6%97%A9%E6%9C%9F%E6%A4%9C%E5%87%BA%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%A8%E3%81%9D%E3%81%AE%E6%96%B9%E6%B3%95/)

</center>

---

# å‚è€ƒã‚µã‚¤ãƒˆ

- [github-search](https://github.com/susatthi/github-search) ï¼ˆç¾åœ¨ä½œæˆä¸­ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚¢ãƒ—ãƒªï¼‰
- [flutter-sample-ci](https://github.com/susatthi/flutter-sample-ci) (ä»Šå›ä½œæˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª)
- [CI(ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)ã¨ã¯ï¼Ÿ](https://cloudbees.techmatrix.jp/devops/ci/)
- [ãƒ‡ã‚°ãƒ¬ã‚’ã¶ã¡ã‹ã¾ã—ãŸã®ã§ã€é–‹ç™ºä½œæ¥­ã‚’1é€±é–“ä»¥ä¸Šæ­¢ã‚ã‚‰ã‚ŒãŸè©±ã€‚](http://ht-jp.net/blog/pc/dev-memo/degrade)

